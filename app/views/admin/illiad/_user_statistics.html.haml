= javascript_include_tag 'application'

-# Access form option for the year
- fiscal_year = params[:fiscal_year].nil? ? 2021 : params[:fiscal_year].to_i
-# Access form option for library id input
- library_id = params[:library_id].nil? ? nil : params[:library_id]
- library_id = library_id.to_i < 0 ? nil : library_id

%h2= "Displaying ILLiad User Group Summary for the #{fiscal_year} fiscal year at the University of Pennsylvania"

- table, groups = build_user_table(fiscal_year, library_id)

<!-- Build the table -->
- process_types.each do |p_k, p_v|
  %hr
  %h2{:style => "font-weight:bold;color:#011F5B"}= p_v
  - request_types.each do |r_k, r_v|
    %h3{:style => "color:#990000;text-align:center;font-weight:bold"}= r_v
    %table.statistics_summary
      %thead
        %tr
          %th Month
          %th Total Requests
          %th Successful Requests
          %th Successful Rate
          %th Failed Requests
          %th Failure Rate
          %th In Progress
          %th Turnaround (days)
      %tbody
        - groups.each do |group|
          %tr
            %td= group.nil? ? "Unknown" : group
            - table[[p_k.to_s, r_k.to_s, group]].each do |cell|
              %td= cell

  %br
