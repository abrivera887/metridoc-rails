= javascript_include_tag 'application'

%ul
  - resources.each do |resource|
    %li= link_to resource.resource_name.human, "/admin/#{resource.resource_name.param_key.pluralize}"
    %li= link_to "Statistical Summary", "statistical_summary"

-furness_table=GateCount::CardSwipe.where(door_name: "FURNESS TURNSTILE_ *FUR").where(swipe_date: '2022-07-01 00:00:00'..'2023-06-30 00:00:00')
-biotech_table=GateCount::CardSwipe.where(door_name: "BIO LIBRARY TURNSTILE GATE_ *JSN").where(swipe_date: '2022-07-01 00:00:00'..'2023-06-30 00:00:00')
-van_pelt_table=GateCount::CardSwipe.where("door_name = ? OR door_name = ? OR door_name = ? OR door_name = ?","VAN PELT LIBRARY TURN1_ *VPL","VAN PELT LIBRARY TURN2_ *VPL","VAN PELT LIBRARY USC HANDICAP ENT VERIFY_ *VPL","VAN PELT LIBRARY ADA DOOR_ *VPL").where(swipe_date: '2022-07-01 00:00:00'..'2023-06-30 00:00:00')

#data-viz
  %h2= t 'active_admin.gatecount.columns_heading'
  #single-col
    %h2 Card Swipes Per Month Per Library Fiscal Year 2023
    = line_chart [{name: "BioTech", data: biotech_table.group_by_month(:swipe_date).count}, {name: "Furness", data: furness_table.group_by_month(:swipe_date).count},{name: "Van Pelt", data: van_pelt_table.group_by_month(:swipe_date).count}], xtitle:"Months", ytitle: "Gate Counts", legend: true, download: true

%h2 Percentage of Gate Counts By School
#data-viz
#left-col
  %h3 Graduate Students
  =pie_chart GateCount::CardSwipe.where(user_group:"Grad Student").where.not("school=? OR school = ?","Penn Libraries","School of Social Policy & Practice").group(:school).count, download: true
#right-col
  %h3 Undergraduate Students
  =pie_chart GateCount::CardSwipe.where(user_group:"Undergraduate Student").where("school=? OR school=? OR school=? OR school=?","College of Arts & Sciences","The Wharton School","School of Engineering and Applied Science","School of Nursing").group(:school).count, download: true

%h2 Percentage of Graduate Students Using the Library
#single-col
  =column_chart GateCount::CardSwipe.where(user_group:"Grad Student").group(:school).count, download: true

-total_bio=biotech_table.count
-total_vp=van_pelt_table.count
-total_furn=furness_table.count

=all_nums=Array.new(3) {Array.new(4)}

-school_names=["College of Arts & Sciences","The Wharton School","School of Engineering and Applied Science","School of Nursing"]

-school_index=[0,1,2,3]

-school_index.each {|i| all_nums[0][i]=(biotech_table.where("school=?", school_names[i]).count).fdiv(total_bio)}
-school_index.each {|i| all_nums[1][i]=(van_pelt_table.where("school=?", school_names[i]).count).fdiv(total_vp)}
-school_index.each {|i| all_nums[2][i]=(furness_table.where("school=?", school_names[i]).count).fdiv(total_furn)}

%h2 Percentage of Gate Counts Per Library (Undergraduate Students)
#single-col
  =column_chart [{name: "BioTech", data: all_nums[0]}, {name: "Van Pelt", data: all_nums[1]}, {name: "Furness", data: all_nums[2]}], download: true
