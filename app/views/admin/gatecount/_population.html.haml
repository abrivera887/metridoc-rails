= javascript_include_tag 'population','application'

%ul

  %li= link_to "Undergraduate Statistics", "undergraduate_statistics"
  %li= link_to "Graduate Statistics", "graduate_statistics"

-pop_baseline={"1":1,"26":1}
-user_baseline=Hash.new
-for i in (0..25).to_a
  -user_baseline["#{i+1}"]=0.7

-#new Chartkick.ColumnChart("chart",[{"name": "Single Visit", "data": percents_single},{"name": "Medium Visits", "data": percents_medium}, {"name":"Freq Visits", "data": percents_freq},{"name":"User Baseline", "data":user_baseline}], { library: { series: { 0: { color: "red"}, 1: { type: "line", color: "yellow" }, 2: { type: "line", color: "blue" },  3: { type: "line", color: "black" } } } });

-#column_chart([{"name":"User Baseline", "data":user_baseline},{"name": "Single Visit", "data": percents_single},{"name": "Medium Visits", "data": percents_medium}, {"name":"Freq Visits", "data": percents_freq}],  library: { :series => { 0 => { type: "line_chart"}}})

-libraries=["Van Pelt","Biotech","Furness"]

-schools=['College of Arts & Sciences',"The Wharton School","Annenberg School for Communication","School of Dental Medicine","School of Design",'Graduate School of Education','School of Engineering and Applied Science','Law School',"Perelman School of Medicine","Veterinary Medicine","School of Nursing","School of Social Policy & Practice"]

-school_index=(0..schools.length-1).to_a

%hr
%h2{style: "text-align:center;"} Fiscal Year 2023 School Population Statistics

Note that the y-scale of the plot below is set to the percent of the college population that used the library over the course of the semester. The bars indicate the percent of library users that went to the library within a given week. This plot may be remade with a given school/library selected. Have fun!

-sas_gen_table=gen_stats(freq_table,2023,"Van Pelt","College of Arts & Sciences")
-percents_zero,percents_single,percents_medium,percents_freq=time_counts(sas_gen_table,"Weekly","Frequency",0)

-input_school="The Wharton School"
-input_library="Biotech"

-#url: admin_population_penetration_path

-# Make a form to select a school for an output plot
%center
  = form_tag(admin_population_penetration_path,html: {id: "random_id"}, method: :get,remote: true) do
    %table{:style => "background-color:#DADADA"}
      %tr
        %td Select Library
        %td= select_tag "library", options_for_select(libraries, libraries[0])
        %td
      %tr
        %td Select School
        %td= select_tag "school", options_for_select(schools, schools[0])
        %td{rowspan:"3"}= submit_tag "Submit"

-#for the error, want to just plug in a default value...

:javascript
  $(document).on("ajax:complete",'#random_id', function(event, data, status, xhr) {var input_school=data.school})

-puts input_school
-puts input_library

#data-viz
  #single-col
    %h2{style: "text-align:center;"} Frequency of College of Arts and Sciences Visitors to the Van Pelt Library, Spring Semester 2023
    = column_chart [{name: "Single Visit", data: percents_single},{name: "Medium Visits", data: percents_medium}, {name:"Freq Visits", data: percents_freq}], xtitle:"Week of the Semester", ytitle: "Percent of the School Population", legend: true, dataset:{borderWidth:0}, max: 0.7, stacked: true, download: true  

  -ymax,percents_single,percents_medium,percents_freq=time_counts(gen_stats(freq_table,2023,input_library,input_school),"Weekly","Frequency",0)

#data-viz
  #single-col
    %h2{style: "text-align:center;"}="Frequency of #{input_school} Visitors to the #{input_library} Library, Spring Semester 2023"
    = column_chart [{name: "Single Visit", data: percents_single},{name: "Medium Visits", data: percents_medium}, {name:"Freq Visits", data: percents_freq}], xtitle:"Week of the Semester", ytitle: "Percent of the School Population", legend: true, dataset:{borderWidth:0}, max: ymax, stacked: true, refresh: 15, download: true  
