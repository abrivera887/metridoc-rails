= javascript_include_tag 'application'

<!-- TODO: Make this a form option for the year -->
- fiscal_year = 2021
<!-- TODO: Make this an optional form option for library id input -->
- library_id = nil

<!-- Get the lending table -->
- lending_table, display_months = prepare_summary_table(fiscal_year, library_id, false)

<!-- Number of columns to reserve for the months -->
- n_month_columns = display_months.size * 2

<!-- Build the table -->
%h2= "Items by Lending Institution"
%table.statistics_summary
  %thead
    %tr
      %th{:rowspan => 3} Lending Institution
      %th{:rowspan => 3}  Library ID
      %th{:colspan => 3, :rowspan => 2} Turnaround Time (days)
      %th{:colspan => 3, :rowspan => 2} Year
      %th{:colspan => n_month_columns} Filled Items Per Month
    %tr
      - display_months.each do |m|
        %th{:colspan => 2}= Date::MONTHNAMES[m]
    %tr
      %th Req-Rec
      %th Req-Shp
      %th Shp-Rec
      %th Items
      %th Fill Rate
      %th Last Year
      -display_months.each do
        %th This Year
        %th Last Year
  %tbody
    - lending_table.each do |row|
      %tr
      - row.each do |cell|
        %td= cell

<!-- Get the borrowing table -->
- borrowing_table, display_months = prepare_summary_table(fiscal_year, library_id, true)

<!-- Build the table -->
%h2= "Items by Borrowing Institution"
%table.statistics_summary
  %thead
    %tr
      %th{:rowspan => 3} Borrowing Institution
      %th{:rowspan => 3}  Library ID
      %th{:colspan => 3, :rowspan => 2} Turnaround Time (days)
      %th{:colspan => 3, :rowspan => 2} Year
      %th{:colspan => n_month_columns} Filled Items Per Month
    %tr
      - display_months.each do |m|
        %th{:colspan => 2}= Date::MONTHNAMES[m]
    %tr
      %th Req-Rec
      %th Req-Shp
      %th Shp-Rec
      %th Items
      %th Fill Rate
      %th Last Year
      -display_months.each do
        %th This Year
        %th Last Year
  %tbody
    - lending_table.each do |row|
      %tr
      - row.each do |cell|
        %td= cell
